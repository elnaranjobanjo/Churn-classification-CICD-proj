version: "3"
dotenv: [".env"]

tasks:
  sync:
    desc: Sync project dependencies with uv
    cmds:
      - uv sync --extra dev
  style:
    desc: Run Ruff autofix, format, then MyPy
    deps: [sync]
    cmds:
      - uv run ruff check . --fix
      - uv run ruff format .
  ingest:
    desc: Ingest Bitcoin candles via Binance and store them in DuckDB
    deps: [sync]
    cmds:
      - |
        uv run python main.py ingest
  track:
    desc: Train and log experiment via MLFlow
    deps: [sync]
    cmds:
      - |
        uv run python main.py track \
          --experiment ${EXPERIMENT:-bitcoin_preds} \
          ${RUN_NAME:+--run-name "$RUN_NAME"}
  # register:
  #   desc: Register a tracked run's model in the MLFlow registry
  #   deps: [sync]
  #   cmds:
  #     - |
  #       uv run python main.py register \
  #         --run-id ${RUN_ID:?RUN_ID required} \
  #         --model-name ${MODEL_NAME:-housing-prices-model} \
  #         ${MODEL_ALIAS:+--alias "$MODEL_ALIAS"}
  mlflow-ui:
    desc: Launch the MLFlow local UI
    deps: [sync]
    cmds:
      - uv run mlflow ui --backend-store-uri ./mlruns